{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# üöÄ –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –æ –ø—Ä–æ–¥–∞–∂–∞—Ö\n",
    "## –†–∞–±–æ—Ç–∞ —Å –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω—ã–º —Ñ–∞–π–ª–æ–º merged_sales_data.csv"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 1. –ò–º–ø–æ—Ä—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "import pandas as pd\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "import seaborn as sns\n",
    "from datetime import datetime\n",
    "import warnings\n",
    "warnings.filterwarnings('ignore')\n",
    "\n",
    "# –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è\n",
    "import plotly.express as px\n",
    "import plotly.graph_objects as go\n",
    "from plotly.subplots import make_subplots\n",
    "\n",
    "# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è\n",
    "pd.set_option('display.max_columns', None)\n",
    "pd.set_option('display.max_rows', 100)\n",
    "plt.style.use('seaborn-v0_8')\n",
    "sns.set_palette(\"husl\")\n",
    "\n",
    "print(\"‚úÖ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω—ã\")"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 2. –ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ CSV —Ñ–∞–π–ª–∞"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def load_merged_data():\n",
    "    \"\"\"–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–≥–æ CSV —Ñ–∞–π–ª–∞\"\"\"\n",
    "    \n",
    "    csv_file = 'merged_sales_data.csv'\n",
    "    \n",
    "    try:\n",
    "        df = pd.read_csv(csv_file, encoding='utf-8')\n",
    "        print(f\"‚úÖ –§–∞–π–ª {csv_file} —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω\")\n",
    "        print(f\"üìä –†–∞–∑–º–µ—Ä –¥–∞–Ω–Ω—ã—Ö: {df.shape}\")\n",
    "        return df\n",
    "        \n",
    "    except FileNotFoundError:\n",
    "        print(f\"‚ùå –§–∞–π–ª {csv_file} –Ω–µ –Ω–∞–π–¥–µ–Ω\")\n",
    "        print(\"üìÅ –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ç–µ–∫—É—â–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏\")\n",
    "        return None\n",
    "    except Exception as e:\n",
    "        print(f\"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {e}\")\n",
    "        return None\n",
    "\n",
    "# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ\n",
    "df = load_merged_data()\n",
    "\n",
    "if df is not None:\n",
    "    print(\"\\nüëÄ –ü–µ—Ä–≤—ã–µ 3 —Å—Ç—Ä–æ–∫–∏ –¥–∞–Ω–Ω—ã—Ö:\")\n",
    "    display(df.head(3))\n",
    "    \n",
    "    print(\"\\nüìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–∞–Ω–Ω—ã—Ö:\")\n",
    "    print(df.info())"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 3. –û—á–∏—Å—Ç–∫–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def clean_and_transform_data(df):\n",
    "    \"\"\"–û—á–∏—Å—Ç–∫–∞ –∏ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö\"\"\"\n",
    "    \n",
    "    print(\"üßπ –û–ß–ò–°–¢–ö–ê –ò –ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–ï –î–ê–ù–ù–´–•\")\n",
    "    print(\"=\" * 50)\n",
    "    \n",
    "    # –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π —Ä–∞–∑–º–µ—Ä\n",
    "    initial_count = len(df)\n",
    "    print(f\"üìä –ò—Å—Ö–æ–¥–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫: {initial_count}\")\n",
    "    \n",
    "    # –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤\n",
    "    df = df.drop_duplicates()\n",
    "    print(f\"üìä –£–¥–∞–ª–µ–Ω–æ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤: {initial_count - len(df)}\")\n",
    "    \n",
    "    # –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π\n",
    "    print(\"\\nüìä –ê–ù–ê–õ–ò–ó –ü–†–û–ü–£–©–ï–ù–ù–´–• –ó–ù–ê–ß–ï–ù–ò–ô:\")\n",
    "    missing_data = df.isnull().sum()\n",
    "    missing_percent = (missing_data / len(df)) * 100\n",
    "    \n",
    "    missing_info = pd.DataFrame({\n",
    "        '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ': missing_data,\n",
    "        '–ü—Ä–æ—Ü–µ–Ω—Ç': missing_percent\n",
    "    }).sort_values('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ', ascending=False)\n",
    "    \n",
    "    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –∫–æ–ª–æ–Ω–∫–∏ —Å –ø—Ä–æ–ø—É—Å–∫–∞–º–∏\n",
    "    missing_columns = missing_info[missing_info['–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ'] > 0]\n",
    "    if len(missing_columns) > 0:\n",
    "        display(missing_columns.head(10))\n",
    "    else:\n",
    "        print(\"   –ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ\")\n",
    "    \n",
    "    # –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–ø—É—Å–∫–æ–≤ –¥–ª—è –∫–ª—é—á–µ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫\n",
    "    print(\"\\nüîß –ó–ê–ü–û–õ–ù–ï–ù–ò–ï –ü–†–û–ü–£–°–ö–û–í:\")\n",
    "    \n",
    "    if 'Color' in df.columns:\n",
    "        df['Color'] = df['Color'].fillna('Not Specified')\n",
    "        print(\"   ‚úÖ Color: –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∏\")\n",
    "    \n",
    "    if 'SubCategory' in df.columns:\n",
    "        df['SubCategory'] = df['SubCategory'].fillna('Unknown')\n",
    "        df['Category'] = df['Category'].fillna('Unknown')\n",
    "        print(\"   ‚úÖ Category/SubCategory: –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∏\")\n",
    "    \n",
    "    # –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫ –∑–∞–ø–æ–ª–Ω—è–µ–º –º–µ–¥–∏–∞–Ω–æ–π\n",
    "    numeric_columns = df.select_dtypes(include=[np.number]).columns\n",
    "    for col in numeric_columns:\n",
    "        if df[col].isnull().sum() > 0:\n",
    "            df[col] = df[col].fillna(df[col].median())\n",
    "            print(f\"   ‚úÖ {col}: –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –ø—Ä–æ–ø—É—Å–∫–∏ –º–µ–¥–∏–∞–Ω–æ–π\")\n",
    "    \n",
    "    # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö\n",
    "    print(\"\\nüîÑ –ü–†–ï–û–ë–†–ê–ó–û–í–ê–ù–ò–ï –¢–ò–ü–û–í –î–ê–ù–ù–´–•:\")\n",
    "    \n",
    "    date_columns = ['OrderDate', 'ShipDate', 'BirthDate', 'DateFirstPurchase', 'StartDate']\n",
    "    \n",
    "    for col in date_columns:\n",
    "        if col in df.columns:\n",
    "            df[col] = pd.to_datetime(df[col], errors='coerce')\n",
    "            print(f\"   üïê {col}: –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∞ –≤ datetime\")\n",
    "    \n",
    "    # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤\n",
    "    print(\"\\nüéØ –°–û–ó–î–ê–ù–ò–ï –ù–û–í–´–• –ü–†–ò–ó–ù–ê–ö–û–í:\")\n",
    "    \n",
    "    if 'OrderDate' in df.columns:\n",
    "        df['OrderYear'] = df['OrderDate'].dt.year\n",
    "        df['OrderMonth'] = df['OrderDate'].dt.month\n",
    "        df['OrderQuarter'] = df['OrderDate'].dt.quarter\n",
    "        df['OrderDayOfWeek'] = df['OrderDate'].dt.day_name()\n",
    "        print(\"   üìÖ –°–æ–∑–¥–∞–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑–Ω–∞–∫–∏ –∏–∑ OrderDate\")\n",
    "        \n",
    "        # –†–∞—Å—á–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –¥–æ—Å—Ç–∞–≤–∫–∏\n",
    "        if 'ShipDate' in df.columns:\n",
    "            df['DeliveryDays'] = (df['ShipDate'] - df['OrderDate']).dt.days\n",
    "            print(\"   üöö –°–æ–∑–¥–∞–Ω –ø—Ä–∏–∑–Ω–∞–∫ DeliveryDays\")\n",
    "    \n",
    "    # –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ–º–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö —Å–µ–≥–º–µ–Ω—Ç–æ–≤\n",
    "    if 'YearlyIncome' in df.columns:\n",
    "        df['IncomeSegment'] = pd.cut(df['YearlyIncome'], \n",
    "                                   bins=[0, 50000, 80000, 100000, float('inf')],\n",
    "                                   labels=['Low', 'Medium', 'High', 'Very High'])\n",
    "        print(\"   üí∞ –°–æ–∑–¥–∞–Ω IncomeSegment\")\n",
    "    \n",
    "    # –†–∞—Å—á–µ—Ç –≤–æ–∑—Ä–∞—Å—Ç–∞ –∫–ª–∏–µ–Ω—Ç–∞\n",
    "    if 'BirthDate' in df.columns:\n",
    "        df['Age'] = (datetime.now() - df['BirthDate']).dt.days // 365\n",
    "        print(\"   üë§ –°–æ–∑–¥–∞–Ω Age\")\n",
    "    \n",
    "    # –†–∞—Å—á–µ—Ç –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏\n",
    "    if 'SalesAmount' in df.columns and 'TotalProductCost' in df.columns:\n",
    "        df['Profit'] = df['SalesAmount'] - df['TotalProductCost']\n",
    "        df['ProfitMargin'] = (df['Profit'] / df['SalesAmount']) * 100\n",
    "        print(\"   üíµ –°–æ–∑–¥–∞–Ω—ã Profit –∏ ProfitMargin\")\n",
    "    \n",
    "    # –†–∞—Å—á–µ—Ç –æ–±—â–µ–π —Å—É–º–º—ã, –µ—Å–ª–∏ –Ω–µ—Ç\n",
    "    if 'UnitPrice' in df.columns and 'OrderQuantity' in df.columns and 'TotalAmount' not in df.columns:\n",
    "        df['TotalAmount'] = df['UnitPrice'] * df['OrderQuantity']\n",
    "        print(\"   üìä –°–æ–∑–¥–∞–Ω TotalAmount\")\n",
    "    \n",
    "    print(f\"\\n‚úÖ –û—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞! –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: {df.shape}\")\n",
    "    return df\n",
    "\n",
    "# –ü—Ä–∏–º–µ–Ω—è–µ–º –æ—á–∏—Å—Ç–∫—É\n",
    "if df is not None:\n",
    "    cleaned_df = clean_and_transform_data(df)\n",
    "else:\n",
    "    cleaned_df = None"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 4. –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö (EDA)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def perform_eda(df):\n",
    "    \"\"\"–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö\"\"\"\n",
    "    \n",
    "    print(\"üîç –ò–°–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–°–ö–ò–ô –ê–ù–ê–õ–ò–ó –î–ê–ù–ù–´–•\")\n",
    "    print(\"=\" * 50)\n",
    "    \n",
    "    # –ë–∞–∑–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —á–∏—Å–ª–æ–≤—ã—Ö –∫–æ–ª–æ–Ω–æ–∫\n",
    "    numeric_cols = df.select_dtypes(include=[np.number]).columns\n",
    "    print(\"üìà –û–°–ù–û–í–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê (—á–∏—Å–ª–æ–≤—ã–µ –∫–æ–ª–æ–Ω–∫–∏):\")\n",
    "    display(df[numeric_cols].describe())\n",
    "    \n",
    "    # –ê–Ω–∞–ª–∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö\n",
    "    categorical_cols = df.select_dtypes(include=['object']).columns\n",
    "    print(f\"\\nüìä –ö–ê–¢–ï–ì–û–†–ò–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ({len(categorical_cols)}):\")\n",
    "    \n",
    "    for col in categorical_cols[:8]:  # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 8\n",
    "        unique_count = df[col].nunique()\n",
    "        print(f\"   {col}: {unique_count} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π\")\n",
    "        if unique_count <= 10:\n",
    "            value_counts = df[col].value_counts()\n",
    "            print(f\"      –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ: {dict(value_counts)}\")\n",
    "    \n",
    "    return df\n",
    "\n",
    "if cleaned_df is not None:\n",
    "    explored_df = perform_eda(cleaned_df)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 5. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è EDA"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def create_eda_visualizations(df):\n",
    "    \"\"\"–°–æ–∑–¥–∞–Ω–∏–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–π –¥–ª—è EDA\"\"\"\n",
    "    \n",
    "    print(\"üìä –°–û–ó–î–ê–ù–ò–ï –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–ô –î–õ–Ø EDA\")\n",
    "    \n",
    "    # –°–æ–∑–¥–∞–µ–º subplots\n",
    "    fig, axes = plt.subplots(2, 3, figsize=(18, 12))\n",
    "    \n",
    "    # 1. –î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –≤—Ä–µ–º–µ–Ω–∏\n",
    "    if 'OrderDate' in df.columns and 'SalesAmount' in df.columns:\n",
    "        monthly_sales = df.groupby(df['OrderDate'].dt.to_period('M'))['SalesAmount'].sum()\n",
    "        axes[0,0].plot(monthly_sales.index.astype(str), monthly_sales.values, \n",
    "                      marker='o', linewidth=2, color='blue')\n",
    "        axes[0,0].set_title('–î–∏–Ω–∞–º–∏–∫–∞ –ø—Ä–æ–¥–∞–∂ –ø–æ –º–µ—Å—è—Ü–∞–º', fontsize=14, fontweight='bold')\n",
    "        axes[0,0].set_xlabel('–ú–µ—Å—è—Ü')\n",
    "        axes[0,0].set_ylabel('–í—ã—Ä—É—á–∫–∞ (SalesAmount)')\n",
    "        axes[0,0].tick_params(axis='x', rotation=45)\n",
    "        axes[0,0].grid(True, alpha=0.3)\n",
    "    \n",
    "    # 2. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º\n",
    "    if 'Region' in df.columns:\n",
    "        region_sales = df.groupby('Region')['SalesAmount'].sum().sort_values(ascending=False)\n",
    "        axes[0,1].bar(range(len(region_sales)), region_sales.values, color='green', alpha=0.7)\n",
    "        axes[0,1].set_title('–í—ã—Ä—É—á–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º', fontsize=14, fontweight='bold')\n",
    "        axes[0,1].set_xlabel('–†–µ–≥–∏–æ–Ω')\n",
    "        axes[0,1].set_ylabel('–í—ã—Ä—É—á–∫–∞')\n",
    "        axes[0,1].set_xticks(range(len(region_sales)))\n",
    "        axes[0,1].set_xticklabels(region_sales.index, rotation=45)\n",
    "    \n",
    "    # 3. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º –ø—Ä–æ–¥—É–∫—Ç–æ–≤\n",
    "    if 'Category' in df.columns:\n",
    "        category_sales = df.groupby('Category')['SalesAmount'].sum()\n",
    "        axes[0,2].pie(category_sales.values, labels=category_sales.index, \n",
    "                     autopct='%1.1f%%', startangle=90)\n",
    "        axes[0,2].set_title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—ã—Ä—É—á–∫–∏ –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º', fontsize=14, fontweight='bold')\n",
    "    \n",
    "    # 4. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–æ—Ö–æ–¥–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤\n",
    "    if 'YearlyIncome' in df.columns:\n",
    "        axes[1,0].hist(df['YearlyIncome'], bins=20, alpha=0.7, edgecolor='black', color='orange')\n",
    "        axes[1,0].set_title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≥–æ–¥–æ–≤–æ–≥–æ –¥–æ—Ö–æ–¥–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤', fontsize=14, fontweight='bold')\n",
    "        axes[1,0].set_xlabel('–ì–æ–¥–æ–≤–æ–π –¥–æ—Ö–æ–¥')\n",
    "        axes[1,0].set_ylabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤')\n",
    "    \n",
    "    # 5. –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂\n",
    "    if 'SalesAmount' in df.columns:\n",
    "        axes[1,1].hist(df['SalesAmount'], bins=50, alpha=0.7, edgecolor='black', color='red')\n",
    "        axes[1,1].set_title('–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—É–º–º—ã –ø—Ä–æ–¥–∞–∂', fontsize=14, fontweight='bold')\n",
    "        axes[1,1].set_xlabel('–°—É–º–º–∞ –ø—Ä–æ–¥–∞–∂–∏')\n",
    "        axes[1,1].set_ylabel('–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ')\n",
    "    \n",
    "    # 6. –¢–æ–ø –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –≤—ã—Ä—É—á–∫–µ\n",
    "    if 'ProductName' in df.columns:\n",
    "        top_products = df.groupby('ProductName')['SalesAmount'].sum().nlargest(10)\n",
    "        axes[1,2].barh(range(len(top_products)), top_products.values, color='purple', alpha=0.7)\n",
    "        axes[1,2].set_yticks(range(len(top_products)))\n",
    "        axes[1,2].set_yticklabels([label[:25] + '...' if len(label) > 25 else label \n",
    "                                 for label in top_products.index])\n",
    "        axes[1,2].set_title('–¢–æ–ø-10 –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –≤—ã—Ä—É—á–∫–µ', fontsize=14, fontweight='bold')\n",
    "        axes[1,2].set_xlabel('–í—ã—Ä—É—á–∫–∞')\n",
    "    \n",
    "    plt.tight_layout()\n",
    "    plt.savefig('eda_analysis.png', dpi=300, bbox_inches='tight')\n",
    "    plt.show()\n",
    "    \n",
    "    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Å Plotly\n",
    "    print(\"\\nüìà –ò–ù–¢–ï–†–ê–ö–¢–ò–í–ù–´–ï –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–ò:\")\n",
    "    \n",
    "    if 'OrderDate' in df.columns and 'SalesAmount' in df.columns:\n",
    "        # –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏\n",
    "        daily_sales = df.groupby(df['OrderDate'].dt.date)['SalesAmount'].sum().reset_index()\n",
    "        fig1 = px.line(daily_sales, x='OrderDate', y='SalesAmount', \n",
    "                      title='üìà –î–∏–Ω–∞–º–∏–∫–∞ –µ–∂–µ–¥–Ω–µ–≤–Ω—ã—Ö –ø—Ä–æ–¥–∞–∂',\n",
    "                      labels={'OrderDate': '–î–∞—Ç–∞', 'SalesAmount': '–í—ã—Ä—É—á–∫–∞'})\n",
    "        fig1.show()\n",
    "    \n",
    "    if 'Region' in df.columns and 'SalesAmount' in df.columns:\n",
    "        # –ü—Ä–æ–¥–∞–∂–∏ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º\n",
    "        region_performance = df.groupby('Region').agg({\n",
    "            'SalesAmount': 'sum',\n",
    "            'CustomerKey': 'nunique',\n",
    "            'OrderQuantity': 'sum'\n",
    "        }).reset_index()\n",
    "        \n",
    "        fig2 = px.bar(region_performance, x='Region', y='SalesAmount',\n",
    "                     title='üåç –í—ã—Ä—É—á–∫–∞ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º',\n",
    "                     color='CustomerKey',\n",
    "                     labels={'SalesAmount': '–í—ã—Ä—É—á–∫–∞', 'CustomerKey': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤'})\n",
    "        fig2.show()\n",
    "\n",
    "if cleaned_df is not None:\n",
    "    create_eda_visualizations(cleaned_df)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 6. –°–æ–∑–¥–∞–Ω–∏–µ –¥–∞—à–±–æ—Ä–¥–æ–≤"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def create_dashboards(df):\n",
    "    \"\"\"–°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö –¥–∞—à–±–æ—Ä–¥–æ–≤\"\"\"\n",
    "    \n",
    "    print(\"üìä –°–û–ó–î–ê–ù–ò–ï –î–ê–®–ë–û–†–î–û–í\")\n",
    "    \n",
    "    # 1. –î–∞—à–±–æ—Ä–¥ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫\n",
    "    total_revenue = df['SalesAmount'].sum()\n",
    "    total_orders = df['SalesOrderNumber'].nunique()\n",
    "    total_customers = df['CustomerKey'].nunique()\n",
    "    avg_order_value = df.groupby('SalesOrderNumber')['SalesAmount'].sum().mean()\n",
    "    total_profit = df['Profit'].sum() if 'Profit' in df.columns else 0\n",
    "    \n",
    "    # –°–æ–∑–¥–∞–µ–º –¥–∞—à–±–æ—Ä–¥ —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏\n",
    "    fig_metrics = go.Figure()\n",
    "    \n",
    "    fig_metrics.add_trace(go.Indicator(\n",
    "        mode=\"number\",\n",
    "        value=total_revenue,\n",
    "        title={\"text\": \"üí∞ –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞\"},\n",
    "        number={'prefix': \"$\", \"valueformat\": \",.0f\"},\n",
    "        domain={'row': 0, 'column': 0}\n",
    "    ))\n",
    "    \n",
    "    fig_metrics.add_trace(go.Indicator(\n",
    "        mode=\"number\",\n",
    "        value=total_orders,\n",
    "        title={\"text\": \"üì¶ –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤\"},\n",
    "        number={\"valueformat\": \",.0f\"},\n",
    "        domain={'row': 0, 'column': 1}\n",
    "    ))\n",
    "    \n",
    "    fig_metrics.add_trace(go.Indicator(\n",
    "        mode=\"number\",\n",
    "        value=total_customers,\n",
    "        title={\"text\": \"üë• –í—Å–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–æ–≤\"},\n",
    "        number={\"valueformat\": \",.0f\"},\n",
    "        domain={'row': 0, 'column': 2}\n",
    "    ))\n",
    "    \n",
    "    fig_metrics.add_trace(go.Indicator(\n",
    "        mode=\"number\",\n",
    "        value=avg_order_value,\n",
    "        title={\"text\": \"üíµ –°—Ä–µ–¥–Ω–∏–π —á–µ–∫\"},\n",
    "        number={'prefix': \"$\", \"valueformat\": \",.0f\"},\n",
    "        domain={'row': 0, 'column': 3}\n",
    "    ))\n",
    "    \n",
    "    fig_metrics.update_layout(\n",
    "        grid={'rows': 1, 'columns': 4, 'pattern': \"independent\"},\n",
    "        template=\"plotly_white\",\n",
    "        height=300\n",
    "    )\n",
    "    \n",
    "    fig_metrics.show()\n",
    "    \n",
    "    # 2. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π –ª–∏–Ω–µ–π–∫–∏\n",
    "    if 'Category' in df.columns and 'SubCategory' in df.columns:\n",
    "        product_analysis = df.groupby(['Category', 'SubCategory']).agg({\n",
    "            'SalesAmount': 'sum',\n",
    "            'Profit': 'sum',\n",
    "            'OrderQuantity': 'sum'\n",
    "        }).reset_index()\n",
    "        \n",
    "        fig_products = px.treemap(product_analysis,\n",
    "                                 path=['Category', 'SubCategory'],\n",
    "                                 values='SalesAmount',\n",
    "                                 color='Profit',\n",
    "                                 color_continuous_scale='RdYlGn',\n",
    "                                 title='üì¶ –î–µ—Ä–µ–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤ –ø–æ –≤—ã—Ä—É—á–∫–µ –∏ –ø—Ä–∏–±—ã–ª–∏')\n",
    "        fig_products.show()\n",
    "    \n",
    "    # 3. –ê–Ω–∞–ª–∏–∑ –ø–æ –¥–µ–º–æ–≥—Ä–∞—Ñ–∏–∏\n",
    "    if 'Gender' in df.columns and 'YearlyIncome' in df.columns:\n",
    "        demographic_analysis = df.groupby('Gender').agg({\n",
    "            'SalesAmount': 'sum',\n",
    "            'CustomerKey': 'nunique',\n",
    "            'YearlyIncome': 'mean'\n",
    "        }).reset_index()\n",
    "        \n",
    "        fig_demo = px.bar(demographic_analysis, x='Gender', y='SalesAmount',\n",
    "                         color='CustomerKey',\n",
    "                         title='üë• –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥–∞–∂ –ø–æ –ø–æ–ª—É',\n",
    "                         labels={'SalesAmount': '–í—ã—Ä—É—á–∫–∞', 'CustomerKey': '–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤'})\n",
    "        fig_demo.show()\n",
    "    \n",
    "    print(\"‚úÖ –î–∞—à–±–æ—Ä–¥—ã —Å–æ–∑–¥–∞–Ω—ã –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω—ã\")\n",
    "\n",
    "if cleaned_df is not None:\n",
    "    create_dashboards(cleaned_df)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 7. –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def extract_insights(df):\n",
    "    \"\"\"–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –∏–Ω—Å–∞–π—Ç–æ–≤\"\"\"\n",
    "    \n",
    "    print(\"üí° –ö–õ–Æ–ß–ï–í–´–ï –ò–ù–°–ê–ô–¢–´\")\n",
    "    print(\"=\" * 50)\n",
    "    \n",
    "    insights = []\n",
    "    \n",
    "    # 1. –û–±—â–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –±–∏–∑–Ω–µ—Å–∞\n",
    "    total_revenue = df['SalesAmount'].sum()\n",
    "    total_customers = df['CustomerKey'].nunique()\n",
    "    total_products = df['ProductKey'].nunique()\n",
    "    avg_order_value = df.groupby('SalesOrderNumber')['SalesAmount'].sum().mean()\n",
    "    \n",
    "    insights.append(f\"üí∞ –û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞: ${total_revenue:,.0f}\")\n",
    "    insights.append(f\"üë• –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤: {total_customers}\")\n",
    "    insights.append(f\"üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: {total_products}\")\n",
    "    insights.append(f\"üìä –°—Ä–µ–¥–Ω–∏–π —á–µ–∫: ${avg_order_value:,.0f}\")\n",
    "    \n",
    "    # 2. –ê–Ω–∞–ª–∏–∑ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π –±–∞–∑—ã\n",
    "    customer_value = df.groupby('CustomerKey')['SalesAmount'].sum()\n",
    "    if len(customer_value) > 0:\n",
    "        top_20_percent = int(len(customer_value) * 0.2)\n",
    "        top_20_customers = customer_value.nlargest(top_20_percent).sum()\n",
    "        percent_top_20 = (top_20_customers / total_revenue) * 100\n",
    "        \n",
    "        insights.append(f\"üéØ –¢–æ–ø-20% –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø—Ä–∏–Ω–æ—Å—è—Ç {percent_top_20:.1f}% –≤—ã—Ä—É—á–∫–∏\")\n",
    "    \n",
    "    # 3. –ê–Ω–∞–ª–∏–∑ —Ä–µ–≥–∏–æ–Ω–æ–≤\n",
    "    if 'Region' in df.columns:\n",
    "        best_region = df.groupby('Region')['SalesAmount'].sum().idxmax()\n",
    "        best_region_revenue = df.groupby('Region')['SalesAmount'].sum().max()\n",
    "        insights.append(f\"üåç –õ—É—á—à–∏–π —Ä–µ–≥–∏–æ–Ω: {best_region} (${best_region_revenue:,.0f})\")\n",
    "    \n",
    "    # 4. –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ–¥—É–∫—Ç–æ–≤\n",
    "    if 'Category' in df.columns:\n",
    "        best_category = df.groupby('Category')['SalesAmount'].sum().idxmax()\n",
    "        best_category_revenue = df.groupby('Category')['SalesAmount'].sum().max()\n",
    "        insights.append(f\"üì¶ –õ—É—á—à–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è: {best_category} (${best_category_revenue:,.0f})\")\n",
    "    \n",
    "    # 5. –í—Ä–µ–º–µ–Ω–Ω–æ–π –∞–Ω–∞–ª–∏–∑\n",
    "    if 'OrderDate' in df.columns:\n",
    "        monthly_revenue = df.groupby(df['OrderDate'].dt.month)['SalesAmount'].sum()\n",
    "        if len(monthly_revenue) > 0:\n",
    "            best_month = monthly_revenue.idxmax()\n",
    "            worst_month = monthly_revenue.idxmin()\n",
    "            \n",
    "            month_names = {\n",
    "                1: '–Ø–Ω–≤–∞—Ä—å', 2: '–§–µ–≤—Ä–∞–ª—å', 3: '–ú–∞—Ä—Ç', 4: '–ê–ø—Ä–µ–ª—å',\n",
    "                5: '–ú–∞–π', 6: '–ò—é–Ω—å', 7: '–ò—é–ª—å', 8: '–ê–≤–≥—É—Å—Ç',\n",
    "                9: '–°–µ–Ω—Ç—è–±—Ä—å', 10: '–û–∫—Ç—è–±—Ä—å', 11: '–ù–æ—è–±—Ä—å', 12: '–î–µ–∫–∞–±—Ä—å'\n",
    "            }\n",
    "            \n",
    "            insights.append(f\"üìà –õ—É—á—à–∏–π –º–µ—Å—è—Ü: {month_names.get(best_month, best_month)} (${monthly_revenue[best_month]:,.0f})\")\n",
    "            insights.append(f\"üìâ –•—É–¥—à–∏–π –º–µ—Å—è—Ü: {month_names.get(worst_month, worst_month)} (${monthly_revenue[worst_month]:,.0f})\")\n",
    "    \n",
    "    # 6. –ê–Ω–∞–ª–∏–∑ –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç–∏\n",
    "    if 'Profit' in df.columns:\n",
    "        total_profit = df['Profit'].sum()\n",
    "        avg_profit_margin = (total_profit / total_revenue) * 100\n",
    "        insights.append(f\"üíµ –û–±—â–∞—è –ø—Ä–∏–±—ã–ª—å: ${total_profit:,.0f}\")\n",
    "        insights.append(f\"üìä –°—Ä–µ–¥–Ω—è—è –º–∞—Ä–∂–∞ –ø—Ä–∏–±—ã–ª–∏: {avg_profit_margin:.1f}%\")\n",
    "    \n",
    "    print(\"üéØ –û–°–ù–û–í–ù–´–ï –ò–ù–°–ê–ô–¢–´:\")\n",
    "    for i, insight in enumerate(insights, 1):\n",
    "        print(f\"{i}. {insight}\")\n",
    "    \n",
    "    return insights\n",
    "\n",
    "if cleaned_df is not None:\n",
    "    insights = extract_insights(cleaned_df)"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 8. RFM-–∞–Ω–∞–ª–∏–∑"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": [
    "def perform_rfm_analysis(df):\n",
    "    \"\"\"–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ RFM-–∞–Ω–∞–ª–∏–∑–∞\"\"\"\n",
    "    \n",
    "    print(\"üéØ RFM-–ê–ù–ê–õ–ò–ó\")\n",
    "    print(\"=\" * 30)\n",
    "    \n",
    "    # –†–∞—Å—á–µ—Ç RFM –º–µ—Ç—Ä–∏–∫\n",
    "    snapshot_date = df['OrderDate'].max() + pd.Timedelta(days=1)\n",
    "    \n",
    "    rfm = df.groupby('CustomerKey').agg({\n",
    "        'OrderDate': lambda x: (snapshot_date - x.max()).days,  # Recency\n",
    "        'SalesOrderNumber': 'nunique',  # Frequency\n",
    "        'SalesAmount': 'sum'            # Monetary\n",
    "    }).reset_index()\n",
    "    \n",
    "    rfm.columns = ['CustomerKey', 'Recency', 'Frequency', 'Monetary']\n",
    "    \n",
    "    print(\"üìä –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ RFM:\")\n",
    "    display(rfm[['Recency', 'Frequency', 'Monetary']].describe())\n",
    "    \n",
    "    # –°–æ–∑–¥–∞–Ω–∏–µ RFM –∫–≤–∞–Ω—Ç–∏–ª–µ–π\n",
    "    rfm['R_Score'] = pd.qcut(rfm['Recency'], 5, labels=[5, 4, 3, 2, 1])\n",
    "    rfm['F_Score'] = pd.qcut(rfm['Frequency'].rank(method='first'), 5, labels=[1, 2, 3, 4, 5])\n",
    "    rfm['M_Score'] = pd.qcut(rfm['Monetary'].rank(method='first'), 5, labels=[1, 2, 3, 4, 5])\n",
    "    \n",
    "    # RFM —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è\n",
    "    rfm['RFM_Score'] = rfm['R_Score'].astype(str) + rfm['F_Score'].astype(str) + rfm['M_Score'].astype(str)\n",
    "    \n",
    "    # –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Å–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è\n",
    "    def assign_segment(row):\n",
    "        r, f, m = int(row['R_Score']), int(row['F_Score']), int(row['M_Score'])\n",
    "        \n",
    "        if r >=